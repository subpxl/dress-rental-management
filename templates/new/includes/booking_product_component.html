<style>
    .d-ak{
        position: relative;
        top:-38px;
        z-index: 1;
    }
    .in-ak{
        width: 90%;
        z-index: 99;
        height: 38px;
    }
</style>
<table class="table">
    <thead class="thead-dark">
        <tr>
            <th>Name</th>
            <th>Description</th>
            <th>Size</th>
            <th>Price</th>
            <th style="width: 10%;text-align: center;font-size: 25px;padding: 0;font-weight: bolder;cursor: pointer;"><span onclick="addProductForm()">+</span></th>
        </tr>
    </thead>
    <tbody id='productForms'>
        <tr>
            <td>
                <div class="row mr-0">
                    <input type="text" class="form-control in-ak" placeholder="Type A Dress ID" size="30"
                        onkeyup="showResults(this)" onfocus="showResults(this)" name="" required/>
                </div>
                <div class="row mr-0"><select onchange="assingV(this)" name="products" required class="form-select d-ak"></select>
                </div>
            </td>
            <td><input class="form-control" placeholder="description" name="description"></td>
            <td><input class="form-control" placeholder="size" name="size"></td>
            <td><input class="form-control" placeholder="price" name="price"></td>
            <td style="width: 10%;text-align: center;cursor: pointer;">
                <span onclick="removeProductForm(this)"><i class="fa fa-trash" aria-hidden="true"></i>
            </span></td>
            </td>
        </tr>
    </tbody>
</table>
<script>
    startDate = document.getElementById('startDate')
    endDate = document.getElementById('endDate')
    startDateId = document.getElementById('id_startDate')
    endDateId = document.getElementById('id_endDate')
    startTime = document.getElementById('startTime')
    endTime = document.getElementById('endTime')
    startTimeId = document.getElementById('id_startTime')
    endTimeId = document.getElementById('id_endTime')
    var myProductArray = []
    dateForm = document.getElementById('dateForm')
    dateForm.addEventListener("submit", async (e) => {
        e.preventDefault()
        document.getElementById('id_branch').value = document.getElementById('branch_pk').value
        payload = new FormData(dateForm)
        fetch("{% url 'booked_product_search' %}", {
            method: "POST",
            body: payload
        }).then(res => res.json()).then(data => {
            myProductArray = data
        }).then(() => {
            startDateId.value = startDate.value
            endDateId.value = endDate.value
            startTimeId.value = startTime.value
            endTimeId.value = endTime.value
        }
        )
    })
    var nameArr = '';
    function assingV(ele){
        let inputV = ele.parentElement.previousElementSibling.getElementsByTagName('input')[0];
        inputV.value = ele.options[ele.selectedIndex].text;
    }
    function showResults(ele) {
        let searchresult = ele.parentElement.nextElementSibling.childNodes[0];
        searchresult.innerHTML = "<option style='color:red;' disabled> select a product </option>"
        var typedInput = ele.value
        console.log("typed input : ", typedInput, searchresult)
        if (myProductArray.length >= 1) {
            console.log(myProductArray)
            let newarr = myProductArray.filter(a => (a.tag.match(typedInput)))
            console.log('newarr => ', newarr)
            newarr.forEach((item, index) => {
                searchresult.innerHTML += `<option style='color:green;' onclick="assingV(this.parentNode)" class="options" value=${item.id}` + '>' + `${item.color}  ${item.tag} ` + "</option>"
                return item
            })
        } else {
            searchresult.innerHTML += "<option style='color:red;' value=  > no products found </option>"
            console.log("nothing here")
            return
        }
    }
</script>
<script>
    function addProductForm() {
        let tr = document.createElement('tr');
        tr.innerHTML = '<td>'
            + '<div class="row mr-0">'
            + '<input type="text" class="form-control in-ak" placeholder="Type A Dress ID"'
            + 'size="30" onkeyup="showResults(this)" onfocus="showResults(this)" name=""/>'
            + '</div>'
            + '<div class="row mr-0"><select name="products" onchange="assingV(this)" class="form-select d-ak"></select>'
            + '</div>'
            + '</td>'
            + '<td><input class="form-control" placeholder="description" name ="description" ></td>'
            + '<td><input class="form-control" placeholder="size"  name="size"></td>'
            + '<td><input class="form-control" placeholder="price"  name="price"></td>'
            + '<td style="width: 10%;text-align: center;cursor: pointer;">'
            + '<span onclick="removeProductForm(this)"><i class="fa fa-trash" aria-hidden="true"></i>'
            + '</span></td>'
        console.log(tr.innerHTML);
        document.getElementById('productForms').appendChild(tr);
        return;
    };
    function removeProductForm(ele){
        ele.parentNode.parentElement.remove();
        return;
    }
</script>